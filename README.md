## go-news-apigateway

Агрегатор новостей на микросервисной архитектуре.

### Описание:
содержит 5 компонентов:
1. `rss-agg`
2. `api-gateway`
3. `news`
4. `comments`
5. `censor`


### rss-agg
занимается скраппингом rss лент, указанных в `config.json`, и их записью в БД.

### api-gateway
входная точка для поьзователя, запускается на `localhost` на порту `8080`.

работает с 4 методами:
#### 1. GET /news/{news_id}
в ответе содержит полную информацию о новости и список всех комментариев к ней
(формат ID UUID).

#### 2. GET /news/tree/{news_id}
в ответе содержит полную информацию о новости и дерево комменариев к ней.

#### 3. GET /news
в параметрах запроса можно передать `reg_exp` - регулярное выражение для поиска постов,
и `page` - номер страницы, которую следует вернуть,
на 1 страницу приходится 10 постов.

#### 4. POST /comments
в теле запроса нужно указать `news_id` - id новости,
`parent_id` - id верхнего комментария (можно указать `null`),
`content` - текст комментария.

### news
микросервис возвращает новости по запросу.
У него 2 метода:

#### 1. GET /news/id
требует ID новости в теле запроса, возвращает полную информацию об этой новости.
#### 2. GET /news/reg_exp
требует текст регулярного выражения в теле запроса и номер желаемой страницы,
возвращает массив постов и информацию о пагинации.

### comments
микросервис работает с комментариями, содержит 3 метода:
#### 1. POST /comments
требует `news_id`, `parent_id`, `content` в теле запроса,
добавляет комментарий в базу данных.
#### 2. GET /comments
требует `news_id` в теле запроса, возвращает массив всех комментариев к этой новости.
#### 3. GET /comments/tree
Требует `news_id` в теле запроса, возвращает дерево всех комментариев к этой новости.

### censor
микросервис проверяет комментарий на удовлетворение правилам
перед добавлением в БД

1 метод:
#### PUT /censor
принимает `content` - текст комментария в теле запроса,
возвращает `is_censored` - `true` или `false`.


### Запуск
`rss-agg`,  `news`, `comments` требуют запущенную `postgres`.
БД для них всех одна общая.
Строка подключения для них всех выглядит так:
```
"postgres://postgres:password@localhost:5432/apigateway?sslmode=disable"
```
- user: `postgres`;
- пароль: `password`;
- название БД: `apigateway`.

Для запуска их надо заменить на актульные для вас.

Все микросервисы запускаются на `localhost` на разных портах:
- `api-gateway`: `8080`;
- `comments`: `8081`;
- `news`: `8082`;
- `censor`: `8083`.


### docker-compose

Все микросервисы можно запустить с помощью `docker-compose`.
Поскольку БД здесь общая, ее все так же необходимо запустить локально.
Строка подключения к базе данных берется из окружения.

```
sudo docker-compose up
```